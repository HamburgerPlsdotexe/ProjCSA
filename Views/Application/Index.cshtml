@model IEnumerable<ProjectCSA.Models.ScheduleModel>
@{
    ViewBag.Title = "Home Page";
}

<div class=wrap>
    <div class="header">
        <div class="headers">
            @if (User.Identity.Name == "Admin")
            {
                <a class="headerbuttons" href="~/Application/ViewTeachers/">TEACHERS</a>
            }
            @{
                DateTime StartSem = new DateTime(2019, 11, 18);
                DateTime EndSem = new DateTime(2020, 2, 17);
                DateTime startDate = new DateTime(2019, 12, 2);  //test
                DateTime dateAndTime = DateTime.Now; //Current Date
                var date = dateAndTime.ToString("dd/MM/yyyy");  //String current date
                var day = dateAndTime.DayOfWeek; // Current day
            }
            <a class="headerbuttons">
                @(day)
                @(date)
            </a>

            @Html.ActionLink("Next week", "ReloadSchedule", "Application", null, new { @class = "headerbuttons" })
            <a class="headerbuttons" href="#">STATISTICS</a>
            <a class="headerbuttons">Current user: @Html.Action("GetUserTcode", "Application")</a>
            @Html.ActionLink("Logout", "LogOut", "Application")
        </div>
    </div>

    <div class="maincontent">

        @if (User.Identity.Name == "Admin")
        {
            <div class="center"> <a> You're an admin, you do not have a schedule.</a> </div>
        }
        else
        {
            <table class="fixed_header">
                <thead>
                    <tr>
                        <th> <a>Week @Html.Action("GetWeekOfYear", "Application")</a></th>
                        @{ string[] days = { "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday" };}

                        @for (int i = 0; i < days.Length; i++)
                        {
                            <th>@(days[i])</th>
                        }
                    </tr>
                </thead>
                @{
                    TimeSpan BreakToken1 = new TimeSpan(10, 10, 0); //10:10:00 First break
                    TimeSpan BreakToken2 = new TimeSpan(14, 40, 0); //14:40:00 Second break
                    TimeSpan BreakToken3 = new TimeSpan(16, 40, 0); //16:40:00 Third break
                    TimeSpan timeSpan = new TimeSpan(8, 30, 0); //08:30:00
                    TimeSpan AddTime = new TimeSpan(0, 50, 0);  //00:50:00
                    TimeSpan AddTime2 = new TimeSpan(0, 20, 0); //00:20:00 Added time for breaks
                    TimeSpan timeSpan2 = new TimeSpan();
                }
                <tbody>
                    @{ for (int i = 1; i < 16; i++)
                        {
                            if (timeSpan2 == BreakToken1 || timeSpan2 == BreakToken2 || timeSpan2 == BreakToken3)
                            { // check if time is equal to break time
                                timeSpan = timeSpan.Add(AddTime2); //add 20 minutes break time
                            }
                            <tr>
                                <td>
                                    <h3>@(i)</h3>
                                    <a>
                                        @{timeSpan.ToString();}

                                        @(string.Format("{0:00}:{1:00}", timeSpan.Hours, timeSpan.Minutes))
                                    </a>
                                    @{timeSpan2 = timeSpan.Add(AddTime);}
                                    <div>
                                        <a>
                                            @(string.Format("{0:00}:{1:00}", timeSpan2.Hours, timeSpan2.Minutes))
                                            @{timeSpan = timeSpan2;}
                                        </a>
                                    </div>
                                </td>
                
                                @{ int weeks = (int)ViewData["weeks"]; }

                                @for (int x = 0; x < 7; x++)                // For every day of the week
                                {
                                    <td>
                                        @foreach (var item in Model)        // For every scheduleitem in the model
                                        {
                                            if(item.Week == weeks.ToString())
                                            {
                                            if (item.Hours.Contains(i))     // If current hour is in model hours array
                                            {
                                                if (item.Day == days[x])    // Check if model day is equal to current day
                                                {
                                                    @Html.ActionLink(item.Class, "ReturnStudentListViewWithCnum", "Application", new { Cnum = item.Class }, null) //????
                                                    @(item.Classroom)
                                                }
                                                else
                                                {
                                                    @("")
                                                }
                                            }
                                            }

                                        }

                                    </td>
                                }

                            </tr>
                        }
                    }
            </table>


        }
    </div>
</div>